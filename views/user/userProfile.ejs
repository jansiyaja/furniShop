<!DOCTYPE html>
<html lang="en">


<!-- molla/index-1.html  22 Nov 2019 09:55:06 GMT -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Molla - Bootstrap eCommerce Template</title>
    <meta name="keywords" content="HTML5 Template">
    <meta name="description" content="Molla - Bootstrap eCommerce Template">
    <meta name="author" content="p-themes">
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/icons/favicon-16x16.png">
    <link rel="manifest" href="assets/images/icons/site.html">
    <link rel="mask-icon" href="assets/images/icons/safari-pinned-tab.svg" color="#666666">
    <link rel="shortcut icon" href="assets/images/icons/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Molla">
    <meta name="application-name" content="Molla">
    <meta name="msapplication-TileColor" content="#cc9966">
    <meta name="msapplication-config" content="assets/images/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="assets/vendor/line-awesome/line-awesome/line-awesome/css/line-awesome.min.css">
    <!-- Plugins CSS File -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/plugins/owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="assets/css/plugins/magnific-popup/magnific-popup.css">
    <link rel="stylesheet" href="assets/css/plugins/jquery.countdown.css">
    <!-- Main CSS File -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/skins/skin-demo-2.css">
    <link rel="stylesheet" href="assets/css/demos/demo-2.css">
<style>
    
    .avatar-and-upload {
  display: flex;
  align-items: center;
}

.avatar {
  width: 100px;
  height: 100px;
  overflow: hidden;
  border-radius: 50%;
  margin-left: 20px;
}

.avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.photo-upload {
  margin-left: 20px;
}
.hidden {
  display: none;
}

.btn{
    min-width:60px;
    gap: 8px;
}
</style>

</head>

<body>
    <div class="page-wrapper">
        <header class="header header-2 header-intro-clearance">

            <div class="header-middle">
                <div class="container">
                    <div class="header-left">
                        <button class="mobile-menu-toggler">
                            <span class="sr-only">Toggle mobile menu</span>
                            <i class="icon-bars"></i>
                        </button>

                        <a href="index.html" class="logo">
                            <img src="assets/images/demos/demo-2/logo.png" alt="Molla Logo" width="105" height="25">
                        </a>
                    </div><!-- End .header-left -->

                    <div class="header-center">

                    </div>

                    <div class="header-right">
                        <!-- <div class="account">
                            <a href="dashboard.html" title="My account">
                                <div class="icon">
                                    <i class="icon-user"></i>
                                </div>
                                <p>Account</p>
                            </a>
                        </div>End .compare-dropdown -->

                        <!-- home.ejs -->
                        <div class="dropdown cart-dropdown">
                            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false" data-display="static">
                                <div class="icon">
                                    <i class="icon-user"></i>
                                </div>
                                <p>Account</p>
                            </a>

                            <div class="dropdown-menu dropdown-menu-right">
                                <!-- Inside your dropdown menu -->
                                <div class="dropdown-cart-products">
                                    <% if (locals.user) { %>
                                        <!-- Display content for logged-in users -->
                                        <div class="product">
                                            <div class="product-cart-details">
                                                <h4 class="product-title">
                                                    <a href="/user">Your Account</a>
                                                </h4>
                                            </div><!-- End .product-cart-details -->
                                        </div><!-- End .product -->

                                        <div class="product">
                                            <div class="product-cart-details">
                                                <h4 class="product-title">
                                                    <a href="/logout">Logout</a>
                                                </h4>
                                            </div><!-- End .product-cart-details -->
                                        </div><!-- End .product -->
                                        <% } else { %>
                                            <!-- Display content for users without an active session (e.g., login link) -->
                                            <div class="product">
                                                <div class="product-cart-details">
                                                    <h4 class="product-title">
                                                        <a href="/login">Login</a>
                                                    </h4>
                                                </div><!-- End .product-cart-details -->
                                            </div><!-- End .product -->
                                            <% } %>
                                </div><!-- End .cart-product -->
                                <!-- End .cart-product -->
                            </div><!-- End .dropdown-menu -->
                        </div>

                        <!-- End .cart-dropdown -->

                        <div class="wishlist">
                            <a href="wishlist.html" title="Wishlist">
                                <div class="icon">
                                    <i class="icon-heart-o"></i>
                                    <span class="wishlist-count badge">3</span>
                                </div>
                                <p>Wishlist</p>
                            </a>
                        </div><!-- End .compare-dropdown -->

                        <div class="dropdown cart-dropdown">
                            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false" data-display="static">
                                <div class="icon">
                                    <i class="icon-shopping-cart"></i>
                                    <span class="cart-count">2</span>
                                </div>
                                <p>Cart</p>
                            </a>

                            <div class="dropdown-menu dropdown-menu-right">
                                <div class="dropdown-cart-products">
                                    <div class="product">
                                        <div class="product-cart-details">
                                            <h4 class="product-title">
                                                <a href="product.html">Beige knitted elastic runner shoes</a>
                                            </h4>

                                            <span class="cart-product-info">
                                                <span class="cart-product-qty">1</span>
                                                x $84.00
                                            </span>
                                        </div><!-- End .product-cart-details -->

                                        <figure class="product-image-container">
                                            <a href="product.html" class="product-image">
                                                <img src="assets/images/products/cart/product-1.jpg" alt="product">
                                            </a>
                                        </figure>
                                        <a href="#" class="btn-remove" title="Remove Product"><i
                                                class="icon-close"></i></a>
                                    </div><!-- End .product -->

                                    <div class="product">
                                        <div class="product-cart-details">
                                            <h4 class="product-title">
                                                <a href="product.html">Blue utility pinafore denim dress</a>
                                            </h4>

                                            <span class="cart-product-info">
                                                <span class="cart-product-qty">1</span>
                                                x $76.00
                                            </span>
                                        </div><!-- End .product-cart-details -->

                                        <figure class="product-image-container">
                                            <a href="product.html" class="product-image">
                                                <img src="assets/images/products/cart/product-2.jpg" alt="product">
                                            </a>
                                        </figure>
                                        <a href="#" class="btn-remove" title="Remove Product"><i
                                                class="icon-close"></i></a>
                                    </div><!-- End .product -->
                                </div><!-- End .cart-product -->

                                <div class="dropdown-cart-total">
                                    <span>Total</span>

                                    <span class="cart-total-price">$160.00</span>
                                </div><!-- End .dropdown-cart-total -->

                                <div class="dropdown-cart-action">
                                    <a href="cart.html" class="btn btn-primary">View Cart</a>
                                    <a href="checkout.html" class="btn btn-outline-primary-2"><span>Checkout</span><i
                                            class="icon-long-arrow-right"></i></a>
                                </div><!-- End .dropdown-cart-total -->
                            </div><!-- End .dropdown-menu -->
                        </div><!-- End .cart-dropdown -->
                    </div><!-- End .header-right -->
                </div><!-- End .container -->
            </div><!-- End .header-middle -->

            <div class="header-bottom sticky-header">
                <div class="container">
                    <div class="header-left">

                    </div><!-- End .header-left -->

                    <div class="header-center">
                        <nav class="main-nav">
                            <ul class="menu sf-arrows">
                                <li class="megamenu-container active">
                                    <a href="/" class="sf-with-ul">Home</a>

                                </li>
                                <li>
                                    <a href="/shop" class="sf-with-ul">Shop</a>


                                </li>
                                <li>
                                    <a href="contact.html" class="sf-with-ul">Contact</a>


                                </li>

                                <li>
                                    <a href="/about" class="sf-with-ul">About</a>


                                </li>



                            </ul><!-- End .menu -->
                        </nav><!-- End .main-nav -->
                    </div><!-- End .header-center -->


                </div><!-- End .container -->
            </div><!-- End .header-bottom -->
        </header><!-- End .header -->

        <section class="content-main">
            
            <div class="card">
              <div class="card-body">
                <div class="row gx-5">
                  <aside class="col-lg-3 border-end">
                    <nav class="nav nav-pills flex-lg-column mb-4">
                        <a class="nav-link active" aria-current="page" href="#" onclick="toggleSection('profile-section', this)">Profile</a>
                        <a class="nav-link" href="#" onclick="toggleSection('addresses-section', this)">Addresses</a>
                        <a class="nav-link" href="#" onclick="toggleSection('orders-section', this)">Orders</a>
                      </nav>
                  </aside>
                  <div class="col-lg-9">
                    <section class="content-box p-xl-4" id="profile-section">
                      
                      <% if (userDetails) { %>
                       
                        <div class="profile-box d-flex justify-content-around">
                          <div class="profile-info-form">

                            <h3>Profile Information</h3>
                            <form id="edit-profile-form">
                              <div class="mb-3">
                                <label for="firstName" class="form-label"> Name:</label>
                                <input type="text" class="form-control" id="firstName" name="firstName" value="<%= userDetails.name%>">
                              </div>
                      
                              <div class="mb-3">
                                <label for="email" class="form-label">Email:</label>
                                <input type="email" class="form-control" id="email" name="email" value="<%= userDetails.email%>">
                              </div>
                              <div class="mb-3">
                                <label for="phone" class="form-label">Phone:</label>
                                <input type="tel" class="form-control" id="phone" name="phone" value="<%= userDetails.mobile%>">
                              </div>
                              
                              <a href="/user?id=<%= userDetails._id %>" id="editLink" class="btn btn-primary"onclick="toggleForms('save')">Edit </a>
                            </form>
                            
                           <form action="/user" method="post" id="save-profile-form"  style="display: none;" onsubmit="return validateCategory()">
                              <div class="mb-3">
                                <label for="firstName" class="form-label"> Name:</label>
                                <input type="text" class="form-control" id="firstName" name="editName" value="<%= userDetails.name%>">
                              </div>
                      
                              <div class="mb-3">
                                <label for="email" class="form-label">Email:</label>
                                <input type="email" class="form-control" id="email" name="editEmail" value="<%= userDetails.email%>">
                              </div>
                              <div class="mb-3">
                                <label for="phone" class="form-label">Phone:</label>
                                <input type="tel" class="form-control" id="phone" name="editPhone" value="<%= userDetails.mobile%>">
                              </div>
                              <button class="btn btn-primary" type="submit" onclick="toggleForms('edit')">save Changes</button>
                            </form>
                          </div>
                          <div class="avatar-and-upload">
                            <div class="avatar">
                              <img src="<%=userDetails.image%>" alt="Avatar">
                            </div>
                            <div class="photo-upload mt-3">
                              <label for="uploadPhoto" class="form-label">Upload Photo:</label>
                              <input type="file" id="uploadPhoto" name="uploadPhoto" accept="image/*">
                            </div>
                          </div>
                        </div>
                           
                          
                      <% } else { %>
                          
                          <p>No user details found.</p>
                      <% } %>
                      </section>
                     
                      <section class="content-body p-xl-4" id="addresses-section">
                        <h3>Addresses</h3>
                        <div id="address-list">
                          <% if (userDetails && userDetails.address.length > 0) { %>
                              <% userDetails.address.forEach(function(address, index) { %>
                                  <div class="card m-2">
                                      <div class="card-body d-flex">
                                          <h5 class="card-text"><%= address.fullName %></h5><br>
                                          <p class="card-text">
                                              <%= address.streetAddress %>, <%= address.city %>, <%= address.state %> <%= address.pincode %>
                                          </p>
                                          <div class="btn-group m-3">
                                              <a href="/edit-address/<%= userDetails._id %>/<%= index %>" class="btn btn-sm btn-primary">Edit</a>
                                              <a href="#" class="btn btn-sm btn-danger" onclick="confirmDelete('<%= userDetails._id %>',<%= index %>)">Delete</a>
                                          </div>
                                      </div>
                                  </div>
                              <% }); %>
                          <% } else { %>
                              <p>No address found.</p>
                          <% } %>
                      
                         
                      </div>
                      
                    
                        <button class="btn btn-primary" id="add-address-btn">Add Address</button>
                    
                        <form action="/addAddress" id="add-address-form" class="hidden" method="post">
                            <div class="mb-3">
                                <label for="fullName" class="form-label">Full Name:</label>
                                <input type="text" class="form-control" id="fullName" name="fullName" placeholder="Enter full name">
                            </div>
                            <div class="mb-3">
                                <label for="streetAddress" class="form-label">Street Address:</label>
                                <input type="text" class="form-control" id="streetAddress" name="streetAddress" placeholder="Enter street address">
                            </div>
                            <div class="mb-3">
                                <label for="city" class="form-label">City:</label>
                                <input type="text" class="form-control" id="city" name="city" placeholder="Enter city">
                            </div>
                            <div class="mb-3">
                                <label for="phone" class="form-label">Phone:</label>
                                <input type="text" class="form-control" id="phone" name="phone" placeholder="Enter phone">
                            </div>
                            <div class="mb-3">
                                <label for="state" class="form-label">State:</label>
                                <input type="text" class="form-control" id="state" name="state" placeholder="Enter state">
                            </div>
                            <div class="mb-3">
                                <label for="zipCode" class="form-label">Zip Code:</label>
                                <input type="text" class="form-control" id="zipCode" name="zipCode" placeholder="Enter zip code">
                            </div>
                    
                            <button class="btn btn-primary" type="submit">Submit</button>
                        </form>
                    </section>
                    
             

                      
        
                    <section class="content-body p-xl-4 hidden" id="orders-section">
                      <h3>Orders</h3>
                      <table class="table">
                        <%if(orders&& orders.length>0){%>
                        <thead>
                          <tr>
                            <th>Order ID</th>
                            <th>Address</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Total</th>
                            <th>more Detils</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% orders.forEach(function(order) { %>
                          <tr>
                            
                            <td><%= order._id%></td>
                            <td>
                              <p><%= order.deliveryAddress.fullName%></p></td>
                            <td><%= order.date.toLocaleDateString() %></td>
                            <td><%= order.status%></td>
                            <td>$<%= order.totalAmount%></td>
                            <td><a href="/orderDetailes/<%= order._id %>" >OrderDetails</a></td>
                          </tr>
                          <% }); %>
                        </tbody>
                        <%}else{%>
                          <div>
                         <p> no orders</p>
                          </div>
                          <%}%>


                      </table>
                    </section>
        
                   
                  </div>
                </div>
              </div>
            </div>
          </section>
  </div>

  <script>

    // toogle the first profile ,address, order
    function toggleSection(sectionId, clickedLink) {
     
      document.querySelectorAll('.content-body').forEach(section => {

        section.classList.add('hidden');
      });
  
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
  
      
      document.getElementById(sectionId).classList.remove('hidden');
  
     
      clickedLink.classList.add('active');
    }

    document.getElementById('add-address-btn').addEventListener('click', function () {
    var addAddressForm = document.getElementById('add-address-form');
    addAddressForm.classList.toggle('hidden');
  });
  
  // toggle form for   edit and save the user profile
    function toggleForms(action) {
        if (action === 'edit') {
            document.getElementById('edit-profile-form').style.display = 'block';
            document.getElementById('save-profile-form').style.display = 'none';
            alert("Edit profile successfully")
        } else if (action === 'save') {
            document.getElementById('edit-profile-form').style.display = 'none';
            document.getElementById('save-profile-form').style.display = 'block';
           
            alert("Do you want edit the profile")
        }
    }
    document.getElementById('editLink').addEventListener('click', function (event) {
        event.preventDefault();
        toggleForms('save');
    });
    
  document.getElementById('add-address-form').addEventListener('submit', function (event) {
    // Add your validation logic here before submitting the form
    var fullNameInput = document.getElementById('fullName');
    var streetAddressInput = document.getElementById('streetAddress');
    var cityInput = document.getElementById('city');
    var phoneInput = document.getElementById('phone');
    var stateInput = document.getElementById('state');
    var zipCodeInput = document.getElementById('zipCode');

    // Validation criteria
    if (!fullNameInput.value.trim()) {
      alert('Full Name is required.');
      event.preventDefault();
      return;
    }

    if (!streetAddressInput.value.trim()) {
      alert('Street Address is required.');
      event.preventDefault();
      return;
    }

    if (!cityInput.value.trim()) {
      alert('City is required.');
      event.preventDefault();
      return;
    }

   
    var zipRegex = /^\d{6}$/;
    if (!zipRegex.test(zipCodeInput.value.trim())) {
      alert('Phone must be a 6-digit number.');
      event.preventDefault();
      return;
    }
   
    var phoneRegex = /^\d{10}$/;
    if (!phoneRegex.test(phoneInput.value.trim())) {
      alert('Phone must be a 10-digit number.');
      event.preventDefault();
      return;
    }

  
    alert('Form submitted successfully!');
  });



    function confirmDelete(userId, addressIndex) {
        if (confirm("Are you sure you want to delete this address?")) {
            // User clicked OK, perform deletion
            window.location.href = `/delete-address/${userId}/${addressIndex}`;
        }
    }

</script>



</script>
  </body>
  </html>